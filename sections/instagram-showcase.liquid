<section class="instagram-showcase" style="
  padding-top: {{ section.settings.padding_top | default: 60 }}px;
  padding-bottom: {{ section.settings.padding_bottom | default: 60 }}px;
  {% if section.settings.mobile_padding_top != blank %}
    --mobile-padding-top: {{ section.settings.mobile_padding_top }}px;
  {% endif %}
  {% if section.settings.mobile_padding_bottom != blank %}
    --mobile-padding-bottom: {{ section.settings.mobile_padding_bottom }}px;
  {% endif %}
  {% if section.settings.mobile_margin_top != blank %}
    --mobile-margin-top: {{ section.settings.mobile_margin_top }}px;
  {% endif %}
  {% if section.settings.mobile_margin_bottom != blank %}
    --mobile-margin-bottom: {{ section.settings.mobile_margin_bottom }}px;
  {% endif %}
  background-color: {{ section.settings.background_color | default: '#ffffff' }};
  width: 100%;
  overflow-x: hidden; /* Prevent horizontal overflow */
  box-sizing: border-box;
">
  <div class="container" style="
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    box-sizing: border-box;
  ">
    <div class="section-header">
      <h2 class="section-title">{{ section.settings.title | escape }}</h2>
      <p class="section-subtitle">{{ section.settings.subtitle | escape }}</p>
    </div>
    
    <div class="instagram-content">
      <div class="instagram-profile">
        <div class="profile-container">
          {% if section.settings.profile_image != blank %}
            <img src="{{ section.settings.profile_image | img_url: 'medium' }}" alt="{{ section.settings.profile_name | escape }}" class="profile-image">
          {% else %}
            <div class="profile-image-placeholder">
              <i class="fab fa-instagram"></i>
            </div>
          {% endif %}
          
          <div class="profile-info">
            <h3 class="profile-name">{{ section.settings.profile_name }}</h3>
            <p class="profile-username">@{{ section.settings.profile_username }}</p>
            <p class="profile-bio">{{ section.settings.profile_bio }}</p>
            
            <div class="profile-stats">
              <div class="stat">
                <span class="stat-value">{{ section.settings.profile_posts }}</span>
                <span class="stat-label">Posts</span>
              </div>
              <div class="stat">
                <span class="stat-value">{{ section.settings.profile_followers }}</span>
                <span class="stat-label">Followers</span>
              </div>
              <div class="stat">
                <span class="stat-value">{{ section.settings.profile_following }}</span>
                <span class="stat-label">Following</span>
              </div>
            </div>
            
            <a href="{{ section.settings.instagram_url }}" class="btn profile-btn" target="_blank">{{ section.settings.profile_button_text }}</a>
          </div>
        </div>
      </div>
      
      <div class="instagram-reels-container">
        {% if section.settings.reel_embed_code_1 != blank or section.settings.reel_embed_code_2 != blank or section.settings.reel_embed_code_3 != blank %}
          {% if section.settings.reel_embed_code_1 != blank %}
            <div class="instagram-reel-item">
              <div class="reel-embed">
                {{ section.settings.reel_embed_code_1 }}
              </div>
            </div>
          {% else %}
            <div class="instagram-reel-item placeholder-reel">
              <div class="placeholder-reel-content">
                <i class="fas fa-video"></i>
                <span>Reel 1</span>
              </div>
            </div>
          {% endif %}
          
          {% if section.settings.reel_embed_code_2 != blank %}
            <div class="instagram-reel-item">
              <div class="reel-embed">
                {{ section.settings.reel_embed_code_2 }}
              </div>
            </div>
          {% else %}
            <div class="instagram-reel-item placeholder-reel">
              <div class="placeholder-reel-content">
                <i class="fas fa-video"></i>
                <span>Reel 2</span>
              </div>
            </div>
          {% endif %}
          
          {% if section.settings.reel_embed_code_3 != blank %}
            <div class="instagram-reel-item">
              <div class="reel-embed">
                {{ section.settings.reel_embed_code_3 }}
              </div>
            </div>
          {% else %}
            <div class="instagram-reel-item placeholder-reel">
              <div class="placeholder-reel-content">
                <i class="fas fa-video"></i>
                <span>Reel 3</span>
              </div>
            </div>
          {% endif %}
        {% else %}
          {% comment %} Display placeholder reels if no embed codes are provided {% endcomment %}
          {% for i in (1..3) %}
            <div class="instagram-reel-item placeholder-reel">
              <div class="placeholder-reel-content">
                <i class="fas fa-video"></i>
                <span>Reel {{ i }}</span>
              </div>
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>
    
    <!-- Mobile Carousel for Reels -->
    <div class="instagram-reels-carousel">
      <div class="carousel-container">
        <div class="carousel-track" role="region" aria-label="Instagram Reels carousel">
          {% if section.settings.reel_embed_code_1 != blank or section.settings.reel_embed_code_2 != blank or section.settings.reel_embed_code_3 != blank %}
            {% if section.settings.reel_embed_code_1 != blank %}
              <div class="carousel-slide" role="tabpanel" aria-label="Instagram Reel 1">
                <div class="reel-container">
                  <div class="reel-embed">
                    {{ section.settings.reel_embed_code_1 }}
                  </div>
                </div>
              </div>
            {% endif %}
            
            {% if section.settings.reel_embed_code_2 != blank %}
              <div class="carousel-slide" role="tabpanel" aria-label="Instagram Reel 2">
                <div class="reel-container">
                  <div class="reel-embed">
                    {{ section.settings.reel_embed_code_2 }}
                  </div>
                </div>
              </div>
            {% endif %}
            
            {% if section.settings.reel_embed_code_3 != blank %}
              <div class="carousel-slide" role="tabpanel" aria-label="Instagram Reel 3">
                <div class="reel-container">
                  <div class="reel-embed">
                    {{ section.settings.reel_embed_code_3 }}
                  </div>
                </div>
              </div>
            {% endif %}
          {% else %}
            {% for i in (1..3) %}
              <div class="carousel-slide" role="tabpanel" aria-label="Instagram Reel Placeholder {{ i }}">
                <div class="reel-container">
                  <div class="reel-placeholder">
                    <i class="fas fa-video"></i>
                    <p>Add Instagram Reel {{ i }} embed code in theme settings</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
      
      <div class="carousel-controls" aria-label="Carousel navigation">
        <button class="carousel-prev carousel-button" aria-label="Previous slide" disabled>
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-next carousel-button" aria-label="Next slide">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      
      <div class="carousel-indicators" role="tablist" aria-label="Carousel pagination">
        {% assign slide_count = 0 %}
        {% if section.settings.reel_embed_code_1 != blank %}{% assign slide_count = slide_count | plus: 1 %}{% endif %}
        {% if section.settings.reel_embed_code_2 != blank %}{% assign slide_count = slide_count | plus: 1 %}{% endif %}
        {% if section.settings.reel_embed_code_3 != blank %}{% assign slide_count = slide_count | plus: 1 %}{% endif %}
        
        {% if slide_count == 0 %}{% assign slide_count = 3 %}{% endif %}
        
        {% for i in (1..slide_count) %}
          <button class="carousel-indicator {% if forloop.first %}active{% endif %}" role="tab" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}" aria-label="Go to slide {{ i }}" aria-controls="slide-{{ i }}"></button>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>
.instagram-showcase {
  padding: 60px 0;
  background-color: {{ section.settings.background_color | default: '#ffffff' }};
  width: 100%;
  overflow-x: hidden; /* Prevent horizontal overflow */
  box-sizing: border-box;
}

.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box;
}

.section-header {
  text-align: center;
  margin-bottom: 40px;
}

.section-title {
  font-size: 32px;
  margin-bottom: 10px;
  font-family: 'Dancing Script', cursive;
  color: #333;
}

.section-subtitle {
  font-size: 16px;
  color: #777;
}

.instagram-content {
  display: grid;
  grid-template-columns: 1fr 3fr;
  gap: 30px;
  margin-top: 40px;
}

.instagram-profile {
  grid-column: 1;
  border: 1px solid #e6e6e6;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.profile-container {
  padding: 30px;
}

.profile-image, .profile-image-placeholder {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  margin-bottom: 20px;
  object-fit: cover;
}

.profile-image-placeholder {
  background-color: #f8f8f8;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  color: #e1306c;
}

.profile-name {
  margin: 0 0 5px;
  font-size: 20px;
  font-weight: 600;
}

.profile-username {
  color: #8e8e8e;
  margin: 0 0 15px;
  font-size: 14px;
}

.profile-bio {
  margin: 0 0 20px;
  font-size: 14px;
  line-height: 1.5;
}

.profile-stats {
  display: flex;
  justify-content: space-between;
  margin-bottom: 25px;
  padding-bottom: 20px;
  border-bottom: 1px solid #efefef;
}

.stat {
  text-align: center;
}

.stat-value {
  display: block;
  font-weight: 600;
  font-size: 16px;
}

.stat-label {
  font-size: 12px;
  color: #8e8e8e;
}

.profile-btn {
  width: 100%;
  text-align: center;
  background-color: #e1306c;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 4px;
  font-weight: 600;
  transition: background-color 0.3s;
  display: inline-block;
  text-decoration: none;
}

.profile-btn:hover {
  background-color: #d62f68;
  color: white;
  text-decoration: none;
}

.instagram-reels-container {
  grid-column: 2;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  width: 100%;
}

.instagram-reel-item {
  border-radius: 10px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  aspect-ratio: 9/16;
  max-height: 500px;
  height: 100%;
}

.reel-embed {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reel-embed iframe {
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
  border: none !important;
}

.placeholder-reel {
  background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
  display: flex;
  align-items: center;
  justify-content: center;
}

.placeholder-reel-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #e1306c;
}

.placeholder-reel-content i {
  font-size: 32px;
  margin-bottom: 10px;
}

.placeholder-reel-content span {
  font-size: 14px;
  font-weight: 500;
}

.instagram-reels-carousel {
  display: none;
  width: 100%;
  margin-top: 20px;
}

.carousel-container {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.carousel-track {
  display: flex;
  transition: transform 0.5s ease;
  width: 100%;
}

.carousel-slide {
  flex: 0 0 100%;
  min-width: 100%;
  position: relative;
  border-radius: 10px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  aspect-ratio: 9/16;
  height: 400px;
}

.carousel-nav {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 15px;
  gap: 15px;
}

.carousel-prev, .carousel-next {
  background: none;
  border: none;
  color: #e1306c;
  font-size: 18px;
  cursor: pointer;
  padding: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.3s ease;
}

.carousel-prev:disabled, .carousel-next:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.carousel-dots {
  display: flex;
  gap: 8px;
}

.carousel-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #ccc;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.carousel-dot.active {
  background-color: #e1306c;
}

/* Responsive styles */
@media (max-width: 991px) {
  .instagram-content {
    grid-template-columns: 1fr 2fr;
  }
}

@media (max-width: 767px) {
  .instagram-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  .instagram-profile {
    width: 100%;
  }
  
  .instagram-reels-container {
    display: none;
  }
  
  .instagram-reels-carousel {
    display: block;
    margin-top: 20px;
  }
}

@media (max-width: 480px) {
  .carousel-slide {
    height: 400px;
  }
}

@media (max-width: 375px) {
  .carousel-slide {
    height: 350px;
  }
}

/* Added styles for mobile-specific padding and margin settings */
@media (max-width: 767px) {
  .instagram-showcase {
    padding-top: var(--mobile-padding-top, 60px);
    padding-bottom: var(--mobile-padding-bottom, 60px);
    margin-top: var(--mobile-margin-top, 0px);
    margin-bottom: var(--mobile-margin-bottom, 0px);
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize variables for carousel
  let currentIndex = 0;
  let touchStartX = 0;
  let touchEndX = 0;
  
  const initCarousel = () => {
    // Get carousel elements
    const track = document.querySelector('.carousel-track');
    if (!track) return; // Exit if track doesn't exist
    
    const slides = track.querySelectorAll('.carousel-slide');
    if (!slides.length) return; // Exit if no slides
    
    const prevButton = document.querySelector('.carousel-prev');
    const nextButton = document.querySelector('.carousel-next');
    const indicators = document.querySelectorAll('.carousel-indicator');
    
    // Reset to first slide
    currentIndex = 0;
    updateCarousel();
    
    // Function to update carousel position and state
    function updateCarousel() {
      // Calculate slide width including gap
      const slideWidth = slides[0].offsetWidth;
      const translateX = -currentIndex * slideWidth;
      
      // Use requestAnimationFrame for smoother animation
      requestAnimationFrame(() => {
        track.style.transform = `translateX(${translateX}px)`;
      });
      
      // Update button states
      if (prevButton) {
        prevButton.disabled = currentIndex === 0;
        prevButton.setAttribute('aria-disabled', currentIndex === 0);
      }
      
      if (nextButton) {
        nextButton.disabled = currentIndex === slides.length - 1;
        nextButton.setAttribute('aria-disabled', currentIndex === slides.length - 1);
      }
      
      // Update indicators
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentIndex);
        indicator.setAttribute('aria-selected', index === currentIndex ? 'true' : 'false');
      });
      
      // Update slide focus and aria attributes
      slides.forEach((slide, index) => {
        slide.setAttribute('aria-hidden', index !== currentIndex);
        slide.tabIndex = index === currentIndex ? 0 : -1;
      });
      
      // Process Instagram embeds after slide change
      processInstagramEmbeds();
    }
    
    // Add event listeners for buttons
    if (prevButton) {
      prevButton.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateCarousel();
          slides[currentIndex].focus();
        }
      });
    }
    
    if (nextButton) {
      nextButton.addEventListener('click', () => {
        if (currentIndex < slides.length - 1) {
          currentIndex++;
          updateCarousel();
          slides[currentIndex].focus();
        }
      });
    }
    
    // Add event listeners for indicators
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
        slides[currentIndex].focus();
      });
      
      // Add keyboard support for indicators
      indicator.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          currentIndex = index;
          updateCarousel();
          slides[currentIndex].focus();
        }
      });
    });
    
    // Add keyboard navigation for the carousel
    track.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        e.preventDefault();
        if (currentIndex > 0) {
          currentIndex--;
          updateCarousel();
          slides[currentIndex].focus();
        }
      } else if (e.key === 'ArrowRight') {
        e.preventDefault();
        if (currentIndex < slides.length - 1) {
          currentIndex++;
          updateCarousel();
          slides[currentIndex].focus();
        }
      }
    });
    
    // Add touch events for swipe
    track.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    track.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });
    
    const handleSwipe = () => {
      const swipeThreshold = 50; // Minimum distance to register as swipe
      
      if (touchEndX < touchStartX - swipeThreshold && currentIndex < slides.length - 1) {
        // Swipe left
        currentIndex++;
        updateCarousel();
      } else if (touchEndX > touchStartX + swipeThreshold && currentIndex > 0) {
        // Swipe right
        currentIndex--;
        updateCarousel();
      }
    };
  };
  
  // Function to process Instagram embeds
  function processInstagramEmbeds() {
    // Check if Instagram embed script exists
    if (window.instgrm) {
      try {
        window.instgrm.Embeds.process();
      } catch (error) {
        console.error('Error processing Instagram embeds:', error);
      }
    } else {
      // If Instagram script hasn't loaded yet, try again after a delay
      setTimeout(() => {
        if (window.instgrm) {
          try {
            window.instgrm.Embeds.process();
          } catch (error) {
            console.error('Error processing Instagram embeds:', error);
          }
        }
      }, 1000);
    }
  }
  
  // Initialize carousel when DOM is loaded
  if (window.innerWidth <= 767) {
    // Use requestIdleCallback if available for better performance
    if (window.requestIdleCallback) {
      requestIdleCallback(() => {
        initCarousel();
      });
    } else {
      setTimeout(() => {
        initCarousel();
      }, 300);
    }
  }
  
  // Reinitialize on resize with debounce
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      if (window.innerWidth <= 767) {
        initCarousel();
      }
    }, 250);
  });
  
  // Add event listener for Instagram script load
  window.addEventListener('load', function() {
    // Process embeds after page fully loads
    setTimeout(processInstagramEmbeds, 1000);
    
    // Load Instagram embed script if embed code is present
    if (document.querySelector('.reel-embed')) {
      // Check if the Instagram embed script is already loaded
      if (!document.getElementById('instagram-embed-script')) {
        const script = document.createElement('script');
        script.id = 'instagram-embed-script';
        script.src = '//www.instagram.com/embed.js';
        script.async = true;
        script.defer = true;
        document.body.appendChild(script);
      }
    }
  });
});
</script>

{% schema %}
{
  "name": "Instagram Showcase",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Follow Our Journey"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Join our cozy community on Instagram"
    },
    {
      "type": "header",
      "content": "Instagram Profile"
    },
    {
      "type": "image_picker",
      "id": "profile_image",
      "label": "Profile Image"
    },
    {
      "type": "text",
      "id": "profile_name",
      "label": "Profile Name",
      "default": "Cozy Whimsy"
    },
    {
      "type": "text",
      "id": "profile_username",
      "label": "Username",
      "default": "cozywhimsy"
    },
    {
      "type": "textarea",
      "id": "profile_bio",
      "label": "Bio",
      "default": "Handcrafted items that bring warmth and whimsy to your home. Made with love in small batches."
    },
    {
      "type": "text",
      "id": "profile_posts",
      "label": "Number of Posts",
      "default": "124"
    },
    {
      "type": "text",
      "id": "profile_followers",
      "label": "Number of Followers",
      "default": "5.2K"
    },
    {
      "type": "text",
      "id": "profile_following",
      "label": "Number Following",
      "default": "328"
    },
    {
      "type": "url",
      "id": "instagram_url",
      "label": "Instagram Profile URL"
    },
    {
      "type": "text",
      "id": "profile_button_text",
      "label": "Profile Button Text",
      "default": "Follow on Instagram"
    },
    {
      "type": "header",
      "content": "Instagram Reels"
    },
    {
      "type": "html",
      "id": "reel_embed_code_1",
      "label": "Reel 1 Embed Code",
      "info": "Paste the embed code from Instagram Reel. To get this: 1) Go to the Reel on Instagram 2) Click '...' 3) Select 'Embed' 4) Copy the code"
    },
    {
      "type": "html",
      "id": "reel_embed_code_2",
      "label": "Reel 2 Embed Code",
      "info": "Paste the embed code from Instagram Reel"
    },
    {
      "type": "html",
      "id": "reel_embed_code_3",
      "label": "Reel 3 Embed Code",
      "info": "Paste the embed code from Instagram Reel"
    },
    {
      "type": "paragraph",
      "content": "The embed codes will display your Instagram Reels in real-time, including likes, comments, and views."
    },
    {
      "type": "number",
      "id": "padding_top",
      "label": "Padding Top",
      "default": 60
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "default": 60
    },
    {
      "type": "number",
      "id": "mobile_padding_top",
      "label": "Mobile Padding Top"
    },
    {
      "type": "number",
      "id": "mobile_padding_bottom",
      "label": "Mobile Padding Bottom"
    },
    {
      "type": "number",
      "id": "mobile_margin_top",
      "label": "Mobile Margin Top"
    },
    {
      "type": "number",
      "id": "mobile_margin_bottom",
      "label": "Mobile Margin Bottom"
    }
  ],
  "blocks": [
    {
      "type": "instagram_post",
      "name": "Instagram Post",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Post Image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Post URL"
        },
        {
          "type": "text",
          "id": "like_count",
          "label": "Number of Likes",
          "default": "42"
        },
        {
          "type": "text",
          "id": "comment_count",
          "label": "Number of Comments",
          "default": "5"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Instagram Showcase",
      "blocks": [
        {
          "type": "instagram_post"
        },
        {
          "type": "instagram_post"
        },
        {
          "type": "instagram_post"
        },
        {
          "type": "instagram_post"
        }
      ]
    }
  ]
}
{% endschema %}
